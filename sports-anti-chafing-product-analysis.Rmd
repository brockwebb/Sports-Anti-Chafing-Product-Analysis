---
title: "Sports-Anti-Chafing-Product-Analysis"
author: "brockwebb45@gmail.com"
date: "March 12, 2016"
output: html_document
url: https://github.com/brockwebb/Sports-Anti-Chafing-Product-Analysis
---

# Synopsis
There are many different options on the market for anti-chafing in sports. The goal of this analysis was to find the best products at the cheapest price. This required looking at as many products as possible on the market and seek see if the are any patterns in ingredient use that can be correlated to user experience through product ratings. 

There are groups of people that decided to attend advanced potion making and create their own blends of products. Those have not been included, but it might be possible to apply some of the patterns learned to either prove out the home made formulas, improve upon them, or put them into questionable standing. It may be cheaper to make your own, but buying all the ingredients may be incredibly expensive and the resulting amount may be more than one can use in several years. Also, one product is sold in bulk with a very generic sounding name, and may just be the best one to buy, saving the time and trouble of a home-brew. 

Most of the products were obtained from Amazon.com. This has led to interesting consequesnces as side-bar advertisements from Amazon have been offering all kinds of sports lube to more 'personal' products. Even suggestions for interesting underwear have been included as a result of these searches. Interesting in the fast that the underwear includes an extra 'pouch' where the wearer might resemble something more like an elephant (think 'trunk') to add 'extra breeze' for separation and moisture management.


# Methodology
*Please note: all the data files used and complete source code is available from the github repository at: https://github.com/brockwebb/Sports-Anti-Chafing-Product-Analysis*



# Environment Setup
## Global Options
Global options set options for general formatting, including suppressing messages and warnings from the code. There are many messages produced that add length to the document and distract from readability. Also, turning on/off all code, chart sizes, etc. to display results is possible here too. 

```{r global_options, include=FALSE}
library(knitr)
opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE, fig.width=8, fig.height=6)
```

## Data libraries
The following libraries are used in this analysis:
1. ggplot2 -- graphics/charts
2. grid -- layout of charts for display
3. lubridate -- handling date/time
4. knitr -- knitr global options for output/file build
5. nortest -- normality testing  
6. plyr -- summarization/aggregation
7. stargazer -- making pretty table outputs easy
```{r}
library(lubridate); library(ggplot2); library(plyr); library(grid); library(nortest); library(stargazer)
```

## Global Functions
None defined yet.

## Loading the Data Files
All the data files used, including this R-Markdown file with complete source code is available from the github repository at: https://github.com/brockwebb/Sports-Anti-Chafing-Product-Analysis/tree/master/data

```{r}
# Loading all the data sets
dfProduct <- as.data.frame(read.csv("./data/Anti-Chafing-Study-Product_Rating.csv"),strip.white=TRUE, header=TRUE)
dfIngredient <- as.data.frame(read.csv("./data/Anti-Chafing-Study-Ingredients.csv"),strip.white=TRUE, header=TRUE)
dfIngredientDefs <- as.data.frame(read.csv("./data/Anti-Chafing-Study-Ingredient_Defs.csv"),strip.white=TRUE, header=TRUE)

# Data Cleaning
# First, we'll combine all the data tables into one massive join, dropping off things that
# are not important like dates and web reference urls, notes, etc.

dfMergeProductIngredient <- merge(dfProduct,dfIngredient,by="Product_ID", all.x=TRUE)

# Removing some unused columns 
dfMergeProductIngredient$Product_Rating_Date <- NULL
dfMergeProductIngredient$Rating_Source <- NULL
dfMergeProductIngredient$Ingredient_Date <- NULL
dfMergeProductIngredient$Ingredient_Source <- NULL
dfMergeProductIngredient$Ingredient_Notes <- NULL
```

#Exploritory Analysis

Let's look at the top ten most common ingredients:
```{r}
# Display top 5 states, runner count, and percentage of total runners from each
dfTopTenIngredients <- as.data.frame(table(dfMergeProductIngredient$Common_Ingredient_Name))
colnames(dfTopTenIngredients) <- c("Ingredient","Product_Count")
dfTopTenIngredients$Product_Percent <- round(dfTopTenIngredients$Product_Count/nrow(dfProduct) * 100, digits=1)
dfTopTenIngredients <- dfTopTenIngredients[order(-dfTopTenIngredients$Product_Count),]
stargazer(head(dfTopTenIngredients,10), type="text", summary=FALSE, rownames=FALSE, digits=0)  # Display top 10
```

Lets look at the total number of different ingredients used, the products with the most and least number of ingredients, and the overall average number of ingredients used with all products.

```{r}
# The total lnumber of ingredients is the number of rows from the 
# dfIngredientDefs table which has all the ingredients listed
# We could add more later, so not hard coding the values is best...
```
The total number of ingredients in `r nrow(dfProduct)` products is: `r nrow(dfIngredientDefs)`

```{r}
# In the merged dataset, since the products are repeated next to each 
# ingredient in it, we can grab the array of the product names 
# and do the counts as the number of ingredients (this is a simple way)
dfProductCounts <- as.data.frame(table(dfMergeProductIngredient$Product))
colnames(dfProductCounts) <- c("Product","Number_of_Ingredients")
dfProductCounts <- dfProductCounts[order(-dfProductCounts$Number_of_Ingredients),]
```

The top five products with the most ingredients are (last two are a tie):

```{r}
stargazer(head(dfProductCounts,6), type="text", summary=FALSE, rownames=FALSE)  # Display top 5 (#5 and #6 are ties)
```

The five products with the least number of ingredients (which is three or less):
```{r}
stargazer(tail(dfProductCounts,5),type="text", summary=FALSE, rownames=FALSE)  # Display bottom 5
```

Now let's look at the top rated products, and include the number of reviews:

```{r}
dfProductRank <-subset(dfProduct, select=c(Product,Reviews,Score))
dfProductRank <- dfProductRank[order(-dfProductRank$Score),]
stargazer(head(dfProductRank,10), type="text", summary=FALSE, rownames=FALSE, digits=2)  # Display top 10
```

Some of the top rated products do not have many reviews, meaning that there could be a lot of bias becuase there is not enough information. So, we will only take the top products with more than 10 reviews.

```{r}
dfProductRank <-subset(dfProduct, Reviews >=10, select=c(Product,Reviews,Score))
dfProductRank <- dfProductRank[order(-dfProductRank$Score),]
stargazer(head(dfProductRank,10), type="text", summary=FALSE, rownames=FALSE, digits=2)  # Display top 10
```

That changes things a bit, and gives us greater confidence based on a larger number of user experiences. Because one focus of this analysis is looking at running products, we'll remove the biking and "off-label" ones, and focus on products that have reviews for "sport" use:

```{r}
dfProductRank <-subset(dfProduct, Reviews >=10 & Product_Audiance =="Sport" & Product_Audiance_Cat2 !="Bike", select=c(Product,Reviews,Score))
dfProductRank <- dfProductRank[order(-dfProductRank$Score),]
stargazer(head(dfProductRank,10), type="text", summary=FALSE, rownames=FALSE, digits=2)  # Display top 10
```

Finially, let's look at products for "general" use and then products specifically advertised for use on the feet. We'll add the product unit cost, but be advised that a little BodyGlide goes a long way, so how much is used per application is different depending on the product. Starting with "general use" products that are advertized for "sports" use first:

```{r}
# Bike products were all specifically used for the "groin" area only, so we can use that to subset the data
dfProductRank <-subset(dfProduct, Reviews >=10 & Product_Audiance =="Sport" & Product_Specific_Use !="Groin" & Product_Specific_Use !="Feet" , select=c(Product,Reviews,Score,Product_Unit_Cost,Product_Size_Unit))
dfProductRank <- dfProductRank[order(-dfProductRank$Score),]
stargazer(head(dfProductRank,10), type="text", summary=FALSE, rownames=FALSE, digits=2)  # Display top 10
```

Now we'll widen the general use products to include "general" and "off-label" use as well:

```{r}
# Bike products were all specifically used for the "groin" area only, so we can use that to subset the data
dfProductRank <-subset(dfProduct, Reviews >=10 & Product_Specific_Use !="Groin" & Product_Specific_Use !="Feet" , select=c(Product,Reviews,Score,Product_Unit_Cost,Product_Size_Unit))
dfProductRank <- dfProductRank[order(-dfProductRank$Score),]
stargazer(head(dfProductRank,10), type="text", summary=FALSE, rownames=FALSE, digits=2)  # Display top 10
```


Looking at products for the feet:
```{r}
# Bike products were all specifically used for the "groin" area only, so we can use that to subset the data
dfProductRank <-subset(dfProduct, Reviews >=10 & Product_Audiance =="Sport" & Product_Specific_Use !="Groin" & Product_Specific_Use !="General" , select=c(Product,Reviews,Score,Product_Unit_Cost,Product_Size_Unit))
dfProductRank <- dfProductRank[order(-dfProductRank$Score),]
stargazer(head(dfProductRank,10), type="text", summary=FALSE, rownames=FALSE, digits=2)  # Display top 10
```

However, there were a lot of "off-label" uses of products for the feet using baby diaper rash cream, so in fairness, we'll look at all "feet" use with any number of reviews:
```{r}
# Bike products were all specifically used for the "groin" area only, so we can use that to subset the data
dfProductRank <-subset(dfProduct, Product_Specific_Use !="Groin" & Product_Specific_Use !="General" , select=c(Product,Reviews,Score,Product_Unit_Cost,Product_Size_Unit))
dfProductRank <- dfProductRank[order(-dfProductRank$Score),]
stargazer(head(dfProductRank,10), type="text", summary=FALSE, rownames=FALSE, digits=2)  # Display top 10
```

## Summary of product rankings
Overall, between the different uses (on or off-label) there was not much seperation in product ranking, and durability for an ultramarathon is definitely more important than cost. However, some products certainly cost more than others. It seems for general use, Good ol' petrolatum (petrolium jelly) is dirt cheap and works well. In the next section, we'll explore the relationship between the water based and oil based products to see if there are any signifigant differences.

*Note: This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>*
     