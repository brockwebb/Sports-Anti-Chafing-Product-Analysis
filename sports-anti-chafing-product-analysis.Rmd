---
title: "Sports-Anti-Chafing-Product-Analysis"
author: "brockwebb45@gmail.com"
date: "March 12, 2016"
output: html_document
url: "https://github.com/brockwebb/Sports-Anti-Chafing-Product-Analysis"
---

# Synopsis
There are many different options on the market for anti-chafing in sports. The goal of this analysis was to find the best products at the cheapest price. This required looking at as many products as possible on the market and seek see if the are any patterns in ingredient use that can be correlated to user experience through product ratings. 

There are groups of people that decided to attend advanced potion making and create their own blends of products. Those have not been included, but it might be possible to apply some of the patterns learned to either prove out the home made formulas, improve upon them, or put them into questionable standing. It may be cheaper to make your own, but buying all the ingredients may be incredibly expensive and the resulting amount may be more than one can use in several years. Also, one product is sold in bulk with a very generic sounding name, and may just be the best one to buy, saving the time and trouble of a home-brew. 

Most of the products were obtained from Amazon.com. This has led to interesting consequesnces as side-bar advertisements from Amazon have been offering all kinds of sports lube to more 'personal' products. Even suggestions for interesting underwear have been included as a result of these searches. Interesting in the fast that the underwear includes an extra 'pouch' where the wearer might resemble something more like an elephant (think 'trunk') to add 'extra breeze' for separation and moisture management.


# Methodology
*Please note: all the data files used and complete source code is available from the github repository at: https://github.com/brockwebb/Sports-Anti-Chafing-Product-Analysis*



# Environment Setup
## Global Options
Global options set options for general formatting, including suppressing messages and warnings from the code. There are many messages produced that add length to the document and distract from readability. Also, turning on/off all code, chart sizes, etc. to display results is possible here too. 

```{r global_options, include=FALSE}
library(knitr)
opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE, fig.width=8, fig.height=6)
```

## Data libraries
The following libraries are used in this analysis:
1. ggplot2 -- graphics/charts
2. grid -- layout of charts for display
3. lubridate -- handling date/time
4. knitr -- knitr global options for output/file build
5. nortest -- normality testing  
6. plyr -- summarization/aggregation 
```{r}
library(lubridate); library(ggplot2); library(plyr); library(grid); library(nortest)
```

## Global Functions
One global function is used to return the equation and r^2 value that is generated by the linear model for display on graphs using ggplot (Regression Equation)
```{r}
# use: before the plot get the formula by calling the function with 
# eqn <- lm_eqn(subBeast,subBeast$avg.time.before.HG, subBeast$time)
# add to the ggplot() something like: 
# + annotate("text",label=eqn,parse=TRUE, x=1000,y=40000)
lm_eqn = function(lab,df,x,y){
    m = lm(y ~ x, df);
    eq <- substitute(sname~":  "~italic(y) == a + b * italic(x)*","~~italic(r)^2~"="~r2, 
#     eq <- substitute(italic(y) == a + b * italic(x)*","~~italic(r)^2~"="~r2, 
         list(sname=lab,
              a = format(coef(m)[1], digits = 3), 
              b = format(coef(m)[2], digits = 3), 
             r2 = format(summary(m)$r.squared, digits = 2))),
    eq <- as.character(as.expression(eq));     
    return(eq)
}
```

## Loading the Data Files
All the data files used, including this R-Markdown file with complete source code is available from the github repository at: https://github.com/brockwebb/Sports-Anti-Chafing-Product-Analysis/tree/master/data

```{r}
# Loading all the data sets
dfProduct <- as.data.frame(read.csv("./data/Anti-Chafing-Study-Product_Rating.csv"),strip.white=TRUE, header=TRUE)
dfIngredient <- as.data.frame(read.csv("./data/Anti-Chafing-Study-Ingredients.csv"),strip.white=TRUE, header=TRUE)
dfIngredientDefs <- as.data.frame(read.csv("./data/Anti-Chafing-Study-Ingredient_Defs.csv"),strip.white=TRUE, header=TRUE)

# Data Cleaning
# First, we'll combine all the data tables into one massive join, dropping off things that
# are not important like dates and web reference urls, notes, etc.

dfMergeProductIngredient <- merge(dfProduct,dfIngredient,by="Product_ID", all.x=TRUE)

# Removing some unused columns 
dfMergeProductIngredient$Product_Rating_Date <- NULL
dfMergeProductIngredient$Rating_Source <- NULL
dfMergeProductIngredient$Ingredient_Date <- NULL
dfMergeProductIngredient$Ingredient_Source <- NULL
dfMergeProductIngredient$Ingredient_Notes <- NULL
```

#Exploritory Analysis

Let's look at the top ten most common ingredients:
```{r}
# Display top 5 states, runner count, and percentage of total runners from each
dfTopTenIngredients <- as.data.frame(table(dfMergeProductIngredient$Common_Ingredient_Name))
colnames(dfTopTenIngredients) <- c("Ingredient","Product_Count")
dfTopTenIngredients$Product_Percent <- round(dfTopTenIngredients$Product_Count/nrow(dfProduct) * 100, digits=1)
dfTopTenIngredients <- dfTopTenIngredients[order(-dfTopTenIngredients$Product_Count),]
head(dfTopTenIngredients,10)  # Display top 10
```


*Note: This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>*
     